# 3D 商品拆解展示系统需求文档

## 1. 项目概述

本项目旨在开发一个功能完善的 3D 商品拆解展示系统，特别针对油车等交通工具，提供从模型处理到专业培训的全流程解决方案。系统将支持模型导入、自动分件、物理仿真拆解、教学培训等核心功能，并提供 AR 应用、数据管理和后台管理等辅助模块。

## 2. 核心功能模块需求

### 2.1 模型处理系统

- **模型导入**

  - 支持 CATIA/SolidWorks/UG 等主流 CAD 软件的原生格式
  - 提供批量上传功能和版本管理机制
  - 具备自动修复非流形几何体的能力

- **格式转换**

  - 自动将导入的 CAD 模型转换为适合 Web 展示的格式
  - 保持模型的几何精度和拓扑结构

- **部件自动分件**

  - 基于材质的自动分组功能
  - 实现连接性分析算法，识别部件间的连接关系
  - 支持碰撞体智能生成（凸包/简化网格）
  - 自动识别并标记运动部件

- **物理属性标注**

  - 支持质量、密度、材料等物理属性的标注
  - 提供预设材料库和自定义材料功能

- **轻量化处理**
  - 自动生成 LOD（高/中/低模）
  - 支持 Draco 几何压缩（压缩率 60-80%）
  - 实现 Basis 纹理压缩（ASTC/ETC2）

### 2.2 拆解引擎

- **流程控制**

  - 嵌入 ISO/SAE 标准拆解流程
  - 提供拆解难度分级（初级/专家）
  - 实现扭矩顺序可视化引导

- **物理仿真**

  - 实现刚体动力学（PBD 算法）
  - 提供流体模拟（简化 Navier-Stokes）
  - 支持热传导可视化

- **反馈机制**

  - 提供实时物理反馈
  - 实现工具匹配提示
  - 提供安全警告功能

- **错误处理**
  - 支持 20+种预设错误场景
  - 提供零件损坏动画
  - 实现智能修复建议

### 2.3 油车专项功能

- **发动机拆解**

  - 提供缸盖螺栓顺序引导
  - 支持活塞环更换模拟
  - 实现正时校对工具

- **燃油系统**

  - 提供燃油流向粒子效果
  - 支持喷雾形态模拟
  - 实现油路堵塞故障模拟

- **变速箱专项**
  - 提供液力变矩器油路可视化
  - 支持同步器结构展示
  - 实现离合接合过程演示

## 3. 辅助功能模块需求

### 3.1 教学培训系统

- **故障诊断沙盒**

  - 提供预设典型故障库
  - 支持拉缸、正时错位等常见故障模拟

- **ASE 认证考核**

  - 实现操作评分算法
  - 提供工具使用、顺序、耗时等多维度评分

- **知识图谱**

  - 基于 Neo4j 图数据库实现
  - 支持部件-故障-方案关联查询

- **维修手册集成**
  - 实现 PDF 解析和 3D 定位功能
  - 支持点击部件跳转手册章节

### 3.2 工具系统

- **智能工具匹配**

  - 提供 200+种虚拟工具库
  - 支持扭矩扳手参数设定
  - 实现错误工具实时警告

- **测量工具**

  - 支持距离测量
  - 支持角度测量
  - 支持半径测量

- **分析工具**

  - 提供热力图分析
  - 支持剖面分析
  - 实现运动轨迹记录与分析

- **标注工具**
  - 支持文字批注
  - 支持箭头标记
  - 支持自由绘制

### 3.3 AR 应用模块

- **移动端实现**

  - 基于 ARKit/ARCore 实现平面检测
  - 支持图像识别+3D 定位
  - 实现 WebRTC 视频流+同步标注
  - 支持 ToF 传感器点云测量

- **AR 设备实现**
  - 支持 HoloLens 2 手势控制
  - 实现空间锚点定位
  - 提供全息共享视图
  - 支持手势测量工具

## 4. 数据管理系统需求

### 4.1 模型数据库

- 设计 VEHICLE、COMPONENT、PART、MATERIAL 等核心数据实体
- 实现实体间的关系映射（包含、组成、材质等）
- 支持模型元数据的存储和查询

### 4.2 知识管理系统

- **故障库**

  - 存储 50+种预设故障模式
  - 维护故障-症状映射关系
  - 支持三维故障标记点

- **维修标准库**
  - 集成 SAE J1930 术语标准
  - 提供 OEM 维修手册集成接口
  - 包含环保操作规范

## 5. 后台管理模块需求

### 5.1 内容管理

- **模型管理**

  - 支持版本控制
  - 提供审批流程
  - 支持元数据编辑

- **剧本编辑**

  - 提供时间轴设计工具
  - 支持路径规划
  - 实现动画录制功能

- **用户管理**
  - 支持角色权限管理
  - 记录培训记录
  - 提供考核统计功能

### 5.2 数据分析

- **用户行为分析**

  - 生成拆解路径热力图
  - 分析操作时长分布
  - 实现错误点聚类分析

- **性能监控**
  - 统计模型加载耗时
  - 监控渲染帧率
  - 分析内存占用

## 6. 部署支持模块需求

### 6.1 多端适配方案

- **PC 工作站**

  - 基于 WebGPU + 实时光追
  - 支持动态 LOD 切换

- **移动终端**

  - 基于 WebGL 2.0 + 实例化
  - 支持纹理压缩(BC7)

- **VR 设备**

  - 基于 OpenXR + 多视图
  - 支持注视点渲染

- **大屏展示**
  - 支持多视口渲染
  - 提供超高清纹理流

### 6.2 云边协同架构

- 设计终端-边缘节点-区域渲染中心-核心云平台的层级架构
- 实现模型数据库和物理引擎集群的云化部署
- 提供传输加密、操作审计、权限隔离等安全机制

## 7. 实施优先级

- **P0 功能**：模型导入、物理反馈、发动机拆解、变速箱基础、故障诊断沙盒、移动端基础 AR
- **P1 功能**：错误处理、流程引导、燃油系统、排气系统、ASE 考核模块、远程协作标注
- **P2 功能**：高级物理仿真、化油器等传统系统、知识图谱深度集成、HoloLens 全功能支持

## 8. 技术栈要求

- 前端：WebGL/WebGPU、Three.js Vue
- 后端：Node.js, rust
- 数据库：mysql
- 物理引擎：commonjs
- AR 技术：ARKit、ARCore、HoloLens SDK

---

## 9. 项目进度记录

### 9.1 已完成内容 ✅

#### 9.1.1 项目基础架构
- ✅ **Monorepo 项目结构搭建**
  - 根目录配置：`package.json`、`docker-compose.yml`、`.env`
  - 前端应用：`apps/web/` (Vue + Vite + Three.js)
  - 后端应用：`apps/api/` (Node.js + Express + Prisma)

#### 9.1.2 技术栈配置
- ✅ **前端技术栈**
  - Vue 3 + Vite (兼容 Node.js 16)
  - TypeScript 配置
  - Vue Router 路由配置
  - Three.js 集成准备

- ✅ **后端技术栈**
  - Node.js + Express
  - TypeScript + ES2022 模块系统
  - Prisma ORM + MySQL 数据库
  - 分层架构设计 (Controller-Service-Repository-Types)

#### 9.1.3 数据库设计
- ✅ **Prisma Schema 设计**
  - Vehicle (车辆) 模型
  - Component (组件) 模型  
  - Part (零件) 模型
  - 完整的关联关系设计

- ✅ **数据库连接**
  - 远程 MySQL 数据库连接成功
  - Prisma Client 生成成功
  - 数据库迁移完成

#### 9.1.4 后端 API 开发
- ✅ **分层架构实现**
  - Types 层：数据模型和接口定义
  - Repository 层：数据访问层 (Vehicle/Component/Part)
  - Service 层：业务逻辑层 (Vehicle/Component/Part)
  - Controller 层：HTTP 请求处理层 (Vehicle/Component)

- ✅ **API 端点实现**
  - 健康检查：`GET /health`、`GET /db/health`
  - 车辆 CRUD：`GET /api/vehicles`、`POST /api/vehicles`、`PUT /api/vehicles/:id`、`DELETE /api/vehicles/:id`
  - 测试数据初始化：`POST /api/seed`

#### 9.1.5 Figma 设计集成
- ✅ **Figma 设计获取**
  - MCP 工具配置
  - Figma 设计数据获取脚本
  - 设计原型页面创建

### 9.2 进行中内容 🔄

#### 9.2.1 后端 API 完善
- 🔄 **路由模块集成**
  - 车辆路由模块 (模块导入问题解决中)
  - 组件路由模块 (待创建)
  - 零件路由模块 (待创建)

#### 9.2.2 前端原型开发
- 🔄 **Figma 设计实现**
  - 设计页面基础结构已创建
  - 1:1 原型实现进行中

### 9.3 待完成内容 ⏳

#### 9.3.1 核心功能模块 (P0 优先级)
- ⏳ **模型处理系统**：模型导入、格式转换、部件分件、物理属性标注
- ⏳ **拆解引擎**：流程控制、物理仿真、反馈机制、错误处理
- ⏳ **油车专项功能**：发动机拆解、燃油系统、变速箱专项

#### 9.3.2 辅助功能模块 (P1 优先级)
- ⏳ **教学培训系统**：故障诊断沙盒、ASE 认证考核、知识图谱
- ⏳ **工具系统**：智能工具匹配、测量工具、分析工具、标注工具
- ⏳ **AR 应用模块**：移动端实现、AR 设备实现

#### 9.3.3 数据管理系统 (P1 优先级)
- ⏳ **知识管理系统**：故障库、维修标准库

#### 9.3.4 后台管理模块 (P2 优先级)
- ⏳ **内容管理**：模型管理、剧本编辑、用户管理
- ⏳ **数据分析**：用户行为分析、性能监控

#### 9.3.5 部署支持模块 (P2 优先级)
- ⏳ **多端适配方案**：PC 工作站、移动终端、VR 设备、大屏展示
- ⏳ **云边协同架构**：层级架构设计、云化部署、安全机制

### 9.4 技术债务和问题 🔧

#### 9.4.1 已解决的问题
- ✅ Node.js 版本兼容性问题 (Vite 降级)
- ✅ Docker 环境缺失问题 (改用远程数据库)
- ✅ Prisma 迁移权限问题 (使用 `db push`)
- ✅ TypeScript 模块导入问题 (ESM 配置)

#### 9.4.2 待解决的问题
- 🔧 **模块导入问题**：车辆路由模块动态导入失败
- 🔧 **前端开发**：Three.js 集成和 3D 场景渲染
- 🔧 **API 完善**：完整的 CRUD 操作、错误处理、认证系统

### 9.5 下一步计划 📋

#### 9.5.1 短期目标 (1-2 周)
1. 解决模块导入问题，完成完整的 CRUD API
2. 完成 Figma 设计到代码的转换
3. 实现基础的 3D 场景展示

#### 9.5.2 中期目标 (1-2 月)
1. 核心功能开发：模型处理、拆解引擎、油车专项功能
2. 前端功能完善：3D 交互界面、拆解操作界面
3. API 系统完善：认证权限、文件管理、实时通信

#### 9.5.3 长期目标 (3-6 月)
1. 高级功能开发：物理仿真、AR/VR 支持、教学培训
2. 系统集成和优化：性能优化、多端适配、云化部署
3. 测试和部署：单元测试、生产部署、用户培训

---

**最后更新时间**: 2025-08-22  
**项目状态**: 基础架构完成，核心功能开发阶段  
**完成度**: 约 15% (基础架构 + 部分 API)

---

## 9. 项目进度记录

### 9.1 已完成内容 ✅

#### 9.1.1 项目基础架构
- ✅ **Monorepo 项目结构搭建**
  - 根目录配置：`package.json`、`docker-compose.yml`、`.env`
  - 前端应用：`apps/web/` (Vue + Vite + Three.js)
  - 后端应用：`apps/api/` (Node.js + Express + Prisma)

#### 9.1.2 技术栈配置
- ✅ **前端技术栈**
  - Vue 3 + Vite (兼容 Node.js 16)
  - TypeScript 配置
  - Vue Router 路由配置
  - Three.js 集成准备

- ✅ **后端技术栈**
  - Node.js + Express
  - TypeScript + ES2022 模块系统
  - Prisma ORM + MySQL 数据库
  - 分层架构设计 (Controller-Service-Repository-Types)

#### 9.1.3 数据库设计
- ✅ **Prisma Schema 设计**
  - Vehicle (车辆) 模型
  - Component (组件) 模型  
  - Part (零件) 模型
  - 完整的关联关系设计

- ✅ **数据库连接**
  - 远程 MySQL 数据库连接成功
  - Prisma Client 生成成功
  - 数据库迁移完成

#### 9.1.4 后端 API 开发
- ✅ **分层架构实现**
  - Types 层：数据模型和接口定义 (`apps/api/src/types/index.ts`)
  - Repository 层：数据访问层
    - `VehicleRepository.ts` - 车辆数据访问
    - `ComponentRepository.ts` - 组件数据访问
    - `PartRepository.ts` - 零件数据访问
  - Service 层：业务逻辑层
    - `VehicleService.ts` - 车辆业务逻辑
    - `ComponentService.ts` - 组件业务逻辑
    - `PartService.ts` - 零件业务逻辑
  - Controller 层：HTTP 请求处理层
    - `VehicleController.ts` - 车辆 API 控制器
    - `ComponentController.ts` - 组件 API 控制器

- ✅ **API 端点实现**
  - 健康检查：`GET /health`、`GET /db/health`
  - 车辆 CRUD：`GET /api/vehicles`、`POST /api/vehicles`、`PUT /api/vehicles/:id`、`DELETE /api/vehicles/:id`
  - 测试数据初始化：`POST /api/seed`

#### 9.1.5 Figma 设计集成
- ✅ **Figma 设计获取**
  - MCP 工具配置 (`~/.cursor/mcp.json`)
  - Figma 设计数据获取脚本 (`scripts/fetch-figma.mjs`)
  - 设计原型页面创建 (`apps/web/src/views/Design.vue`)

#### 9.1.6 后端 API 完善 ✅
- ✅ **路由模块集成**
  - 车辆路由模块 (`apps/api/src/routes/vehicleRoutes.ts`) ✅
  - 组件路由模块 (`apps/api/src/routes/componentRoutes.ts`) ✅
  - 零件路由模块 (`apps/api/src/routes/partRoutes.ts`) ✅
  - 零件控制器 (`apps/api/src/controllers/PartController.ts`) ✅
  - 静态引入路由，取消动态引入和try-catch行为 ✅

- ✅ **完整的 CRUD API**
  - 车辆管理：5个API端点 (GET, GET/:id, POST, PUT/:id, DELETE/:id)
  - 组件管理：6个API端点 (包含根据车辆ID查询)
  - 零件管理：6个API端点 (包含根据组件ID查询)
  - 类型安全：解决Prisma类型与自定义类型兼容性问题
  - API文档：完整的使用说明 (`apps/api/API.md`) ✅
- ✅ **环境变量管理**
  - 根目录 `.env` 配置
  - 数据库连接字符串配置
  - Figma 节点 ID 配置

- ✅ **开发工具配置**
  - Nodemon 热重载配置
  - TypeScript 编译配置
  - ESLint 代码规范配置

### 9.2 进行中内容 🔄

#### 9.2.1 前端原型开发
- 🔄 **Figma 设计实现**
  - 设计页面基础结构已创建
  - 1:1 原型实现进行中
  - Three.js 3D 场景集成准备中

#### 9.2.2 Three.js 集成开发
- 🔄 **3D 场景搭建**
  - 基础场景设置
  - 3D 模型加载器配置
  - 相机和光照系统设置
  - 车辆数据与3D模型关联

### 9.3 待完成内容 ⏳

#### 9.3.1 核心功能模块 (P0 优先级)
- ⏳ **模型处理系统**
  - 模型导入功能
  - 格式转换功能
  - 部件自动分件
  - 物理属性标注
  - 轻量化处理

- ⏳ **拆解引擎**
  - 流程控制
  - 物理仿真
  - 反馈机制
  - 错误处理

- ⏳ **油车专项功能**
  - 发动机拆解
  - 燃油系统
  - 变速箱专项

#### 9.3.2 辅助功能模块 (P1 优先级)
- ⏳ **教学培训系统**
  - 故障诊断沙盒
  - ASE 认证考核
  - 知识图谱
  - 维修手册集成

- ⏳ **工具系统**
  - 智能工具匹配
  - 测量工具
  - 分析工具
  - 标注工具

- ⏳ **AR 应用模块**
  - 移动端实现
  - AR 设备实现

#### 9.3.3 数据管理系统 (P1 优先级)
- ⏳ **知识管理系统**
  - 故障库
  - 维修标准库

#### 9.3.4 后台管理模块 (P2 优先级)
- ⏳ **内容管理**
  - 模型管理
  - 剧本编辑
  - 用户管理

- ⏳ **数据分析**
  - 用户行为分析
  - 性能监控

#### 9.3.5 部署支持模块 (P2 优先级)
- ⏳ **多端适配方案**
  - PC 工作站
  - 移动终端
  - VR 设备
  - 大屏展示

- ⏳ **云边协同架构**
  - 层级架构设计
  - 云化部署
  - 安全机制

### 9.4 技术债务和问题 🔧

#### 9.4.1 已解决的问题
- ✅ Node.js 版本兼容性问题 (Vite 降级)
- ✅ Docker 环境缺失问题 (改用远程数据库)
- ✅ Prisma 迁移权限问题 (使用 `db push`)
- ✅ TypeScript 模块导入问题 (ESM 配置)

#### 9.4.2 待解决的问题
- 🔧 **前端开发**
  - Three.js 集成和配置
  - 3D 场景渲染实现
  - Figma 设计到代码的转换
  - 车辆数据与API集成

- 🔧 **3D模型管理**
  - 模型加载器实现
  - 模型缓存策略
  - 性能优化

### 9.5 下一步计划 📋

#### 9.5.1 短期目标 (1-2 周)
1. **解决模块导入问题**
   - 修复车辆路由模块导入
   - 完成组件和零件路由模块
   - 实现完整的 CRUD API

2. **前端原型开发**
   - 完成 Figma 设计到代码的转换
   - 实现基础的 3D 场景展示
   - 集成 Three.js 渲染引擎

3. **数据库功能完善**
   - 完善数据模型和关系
   - 实现数据验证和约束
   - 添加测试数据生成脚本

#### 9.5.2 中期目标 (1-2 月)
1. **核心功能开发**
   - 模型导入和处理系统
   - 基础的拆解引擎
   - 油车专项功能

2. **前端功能完善**
   - 3D 交互界面
   - 拆解操作界面
   - 用户交互体验

3. **API 系统完善**
   - 认证和权限系统
   - 文件上传和管理
   - 实时通信功能

#### 9.5.3 长期目标 (3-6 月)
1. **高级功能开发**
   - 物理仿真引擎
   - AR/VR 支持
   - 教学培训系统

2. **系统集成和优化**
   - 性能优化
   - 多端适配
   - 云化部署

3. **测试和部署**
   - 单元测试和集成测试
   - 生产环境部署
   - 用户培训和文档

---

**最后更新时间**: 2025-08-22  
**项目状态**: 基础架构完成，核心功能开发阶段  
**完成度**: 约 15% (基础架构 + 部分 API)
